<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="..\..\bower_components/polymer/polymer.html">
<link rel="import" href="..\..\bower_components/paper-input/paper-textarea.html">

<dom-module id="quiz-page">
  <template>
    <style>
      :host {
        background: #FFF;
      }

      paper-material {
        padding: 12px;
        padding-top: 50px;
        background: #FFF;
        margin-bottom: 10px;
      }

      paper-icon-button[icon="arrow-back"] {
        position: absolute;
        left: 0;
        top: 0;
      }

      paper-dialog {
        background: #FFF;
        position: fixed;
        top: 30px;
        z-index: 1;
      }

      .btn-save {
        position: absolute;
        right: 0;
        bottom: 0;
        color: var(--default-primary-color);
      }

      .due-date {
        padding: 8px 0;
      }

      .due-date label {
        -webkit-font-smoothing: antialiased;
        color: rgb(114, 114, 114);
        display: block;
        font-family: Roboto, Noto, sans-serif;
        font-size: 12px;
        font-weight: normal;
        height: 20px;
        letter-spacing: 0.132px;
        line-height: 20px;
        overflow-x: hidden;
        overflow-y: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        width: 233.5px;

      }

      .due-date input {
        border: none;
        color: #212121;
        font-family: 'Roboto', 'Noto', sans-serif;
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
        font-size: 16px;
        font-weight: 400;
        line-height: 24px;
        height: 24px;
        border-bottom: 1px solid rgb(114,114,114);
        width: 100%;
      }

      paper-fab {
        position: fixed;
        right: 25px;
        bottom: 15px;
        z-index: 1;
      }

      #addMenu paper-button + paper-button{
        border-top: 1px solid rgb(114,114,114);
      }

      #dlgTrueOrFalse .content{
        width: 480px;
        min-height: 300px;
      }

      .testpaper-container {
        padding-top: 12px;
        min-height: 340px;
      }

      .item {
        padding: 8px 0px;
      }

      .item + .item {
        border-top: 1px solid var(--divider-color);
      }

      .item .question {
        margin: 0px;
      }

      .item .answer {
        font-size: 0.8em;
        margin: 0px;
      }
      


    </style>
    <paper-material flex>

      <paper-icon-button icon="arrow-back"></paper-icon-button>
      <paper-input label="Title" value="{{ title }}"></paper-input>
      <paper-textarea label="Notes" value="{{ notes }}"></paper-textarea>
      <div class="horizontal layout flex wrap">
        <paper-input class="flex" type="number" label="Duration in Minutes" 
        value="{{ duration }}"></paper-input>
        <div class="due-date flex">
          <label>Due Date</label>
          <input type="datetime-local" value="{{ due_date }}">
        </div>
      </div>
    </paper-material>

    <paper-material class="testpaper-container">
      <p id="instruction">Please click the + button to add questions.</p>
      <div id="testPaper">
        <iron-list items="{{ quizData }}" as="quiz">
          <template>
            <div class="item">
              <p class="question">Question: <span>{{quiz.question}}</span></p>
              <p class="answer">Answer: <span>{{quiz.answer}}</span></p>
            </div>
          </template>
        </iron-list>
      </div>

      <!-- <create-multiple-choice></create-multiple-choice> -->
      <paper-button class="btn-save" on-tap="saveQuiz">Save</paper-button>

    </paper-material>

    <paper-fab icon="add" on-tap="showAddMenu"></paper-fab>

    <paper-dialog id="addMenu">
      <h2>Type</h2>
      <div class="vertical layout">
        <paper-button on-tap="showTrueOrFalse">True or False</paper-button>        
        <paper-button on-tap="showMultipleChoice">Multiple Choice</paper-button>        
        <paper-button>Fill in the blank</paper-button>        
        <paper-button>Essay</paper-button>        
      </div>
      <div class="buttons">
        <!-- <paper-button dialog-dismiss>jkjk</paper-button> -->
      </div>
    </paper-dialog>
    
    <paper-dialog id="dlgTrueOrFalse">
      <h2>True or False</h2>
      <div class="content">
        <create-true-or-false></create-true-or-false>
      </div>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm on-tap="confirmTF">Confirm</paper-button>
      </div>

    </paper-dialog>

    <paper-dialog id="dlgMultipleChoice">
      <h2>True or False</h2>
      <div class="content">
        <create-multiple-choice></create-multiple-choice>
      </div>
      <div class="buttons">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm on-tap="confirmMC">Confirm</paper-button>
      </div>

    </paper-dialog>

    <iron-ajax
        id="ajaxSaveQuiz"
        url="/api/quiz"
        method="post"
        handle-as="json"
        on-response="handleSaveQuizResponse"
        last-response="{{ saveResponse }}"
        debounce-duration="300"></iron-ajax>

  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'quiz-page',

      properties: {
        title: String, 
        notes: String, 
        duration: Number, 
        due_date: String
      }, 

      showAddMenu: function() {
        this.$.addMenu.open();
      },

      showTrueOrFalse: function() {
        this.$.dlgTrueOrFalse.open();
      },

      showMultipleChoice: function() {
        this.$.dlgMultipleChoice.open();
      },


      confirmTF: function() {
        var testPaper = this.$.testPaper;
        var contents = "";
        var question = this.querySelector('create-true-or-false').getAttribute("question");
        var answer = this.querySelector('create-true-or-false').getAttribute("answer");

        this.push('quizData', {
          question: question, 
          answer: answer,
          type: 'true_or_false'
        });
      },

      confirmMC: function() {
        var testPaper = this.$.testPaper;
        var contents = "";
        var question = this.querySelector('create-multiple-choice').getAttribute("question");
        var answer = this.querySelector('create-multiple-choice').getAttribute("answer");


        contents += '<p>Question: ' + question + '</p>';
        contents += '<p>Answer: ' + answer + '</p>';
        testPaper.innerHTML = testPaper.innerHTML + contents;

      },

      handleSaveQuizResponse: function() {
        console.log(this.saveResponse);
        document.querySelector('teachers-quiz-list').refreshList();
      },

      saveQuiz: function() {
        this.$.ajaxSaveQuiz.params = {
          subject_id: app.subject_id,
          title: this.title,
          notes: this.notes == undefined ? '':this.notes,
          duration: this.duration,
          due_date: this.due_date,
          user_id: jwt_decode(localStorage.token).id,
          status: 'open',
          token: localStorage.token,
          questions: JSON.stringify(this.quizData)
        };

        this.$.ajaxSaveQuiz.generateRequest();        
      },


      ready: function() {
        this.quizData = [];
      }


    });
  })();
  </script>
</dom-module>
